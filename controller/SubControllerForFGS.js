/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/Sorter","./utilities"],function(O,F,S,u){"use strict";function g(l,a){return l.getProperty("/#Product/"+a+"/@sap:label");}return O.extend("nw.epm.refapps.ext.prod.manage.controller.SubControllerForFGS",{constructor:function(p,t,a,r){this._oParentView=p;this._oResourceBundle=r;this._oTableOperations=t;this._fnApplyTableOperations=a;this._aDialogs=[];var T=this._getText("xfld.groupPriceBetween",[" 0-100"]),s=this._getText("xfld.groupPriceBetween",[" 100-500"]),b=this._getText("xfld.groupPriceBetween",[" 500-1000"]),c=this._getText("xfld.groupPrice",[" 1000"]);this._oPriceGroups={"LE100":T,"BT100-500":s,"BT500-1000":b,"GT1000":c,"unknownPrice":"?"};var v=p.getModel("viewProperties");v.setProperty("/LE100",T);v.setProperty("/BT100-500",s);v.setProperty("/BT500-1000",b);v.setProperty("/GT1000",c);},openDialog:function(d,i){d="nw.epm.refapps.ext.prod.manage.view."+d;var D=this._aDialogs[d];if(!D){this._aDialogs[d]=D=sap.ui.xmlfragment(d,this);u.attachControlToView(this._oParentView,D);if(i){D.setSelectedSortItem(i);}}return D.open();},onFilterDialogConfirm:function(e){var p=e.getParameters(),P=false,s=false,t="",f=p.filterItems,l=f.length;this._oTableOperations.resetFilters();for(var i=0;i<l;i++){var o=this._oPriceFilters[f[i].getKey()];if(o){this._oTableOperations.addFilter(o,"Price");P=true;}else{o=this._oStockFilters[f[i].getKey()];if(o){this._oTableOperations.addFilter(o,"StockQuantity");s=true;}}}this._fnApplyTableOperations();var v=this._oParentView.getModel("viewProperties"),b=!!this._oTableOperations.getFilterTable();v.setProperty("/filterToolbarVisible",b);if(b){if(P&&s){t=this._getText("xtit.filterBy2",[this._getPriceLabel(),this._getText("xfld.availability")]);}else{t=P?this._getText("xtit.filterBy",[this._getPriceLabel()]):"";t=(!t&&s)?this._getText("xtit.filterBy",[this._getText("xfld.availability")]):t;}v.setProperty("/filterInfoText",t);}},_getPriceLabel:function(){return this._oParentView.getModel().getProperty("/#Product/Price/@sap:label");},_oPriceFilters:{"LE100":new F("Price",sap.ui.model.FilterOperator.LE,"100"),"BT100-500":new F("Price",sap.ui.model.FilterOperator.BT,"100","500"),"BT500-1000":new F("Price",sap.ui.model.FilterOperator.BT,"500","1000"),"GT1000":new F("Price",sap.ui.model.FilterOperator.GE,"1000")},_oStockFilters:{"outofstock":new F("StockQuantity",sap.ui.model.FilterOperator.EQ,"0"),"restrictedstock":new F("StockQuantity",sap.ui.model.FilterOperator.BT,"1","9"),"instock":new F("StockQuantity",sap.ui.model.FilterOperator.GE,"10")},onSortDialogConfirmed:function(e){var p=e.getParameters(),s=p.sortItem.getKey();this._oTableOperations.addSorter(new S(s,p.sortDescending));this._fnApplyTableOperations();},onGroupingDialogConfirmed:function(e){var p=e.getParameters(),s;if(p.groupItem){s=p.groupItem.getKey();if(s!==""){this._oTableOperations.setGrouping(new S(s,p.groupDescending,this._oGroupFunctions[s].bind(this)));}else{this._oTableOperations.removeGrouping();}}this._fnApplyTableOperations();},_oGroupFunctions:{Price:function(l){var k,p=Number(l.getProperty("Price"));if(p<=100){k="LE100";}else if(p<=500){k="BT100-500";}else if(p<=1000){k="BT500-1000";}else if(p>1000){k="GT1000";}else{k="unknownPrice";}return{key:k,text:this._oPriceGroups[k]};},StockQuantity:function(l){var q=Number(l.getProperty("StockQuantity")),k="unknownStockQuantity",t="?";if(q>=0){var L=g(l,"StockQuantity");if(q===0){k="LE0";}else if(q>=10){k="GE10";}else{k="BT1-9";}var i=q===0?"xfld.outstock":(q<10?"xfld.restricted10":"xfld.instock"),v=this._oResourceBundle.getText(i);t=this._oResourceBundle.getText("xfld.groupingLabel",[L,v]);}return{key:k,text:t};},MainCategoryName:function(l){return this._getCategoryName(l,"MainCategoryName");},SubCategoryName:function(l){return this._getCategoryName(l,"SubCategoryName");}},_getCategoryName:function(l,c){var k=l.getProperty(c);return{key:k,text:this._getText("xfld.groupingLabel",[g(l,c),k])};},_getText:function(){return this._oResourceBundle.getText.apply(this._oResourceBundle,arguments);}});});
