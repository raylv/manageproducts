/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/core/routing/History"],function(O,D,H){"use strict";return O.extend("nw.epm.refapps.ext.prod.manage.controller.NavigationManager",{constructor:function(r,a,R,o){this._oRouter=r;this._oApplicationProperties=a;this._mRoutes=R;this._oResourceBundle=o;},init:function(){this._bSubControllersMustBeAdapted=true;this._oRouter.getTargetHandler().setCloseDialogs(false);this._oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this._oRouter.attachBypassed(this.onBypassed,this);this._oRouter.initialize();},registerMaster:function(m){this._oMasterController=m;},registerDetail:function(d){this._oDetailController=d;},onRoutePatternMatched:function(e){var r=e.getParameter("name"),p=(r===this._mRoutes.DETAIL)&&decodeURIComponent(e.getParameter("arguments").productID);this._oApplicationProperties.setProperty("/productId",p);if(p){if(this._bSubControllersMustBeAdapted){this._newProductId();}this._oMasterController.adaptToDetailSelection(this._bSubControllersMustBeAdapted);}this._bSubControllersMustBeAdapted=true;},onBypassed:function(){this._oApplicationProperties.setProperty("/productId","-");this._oApplicationProperties.setProperty("/emptyText",this._oResourceBundle.getText("ymsg.pageNotFound"));this._oMasterController.adaptToDetailSelection(false);},_newProductId:function(){if(this._oDetailController&&!this._oDetailController.editModeChanged()){this._oDetailController.productChanged();}},navBackToMasterPageInPhone:function(){if(D.system.phone){this.navToMaster();return true;}return false;},showProductDetailPage:function(p,l){this._oApplicationProperties.setProperty("/productId",p);this._changeEditMode(false);if(l){this._oMasterController.listRefresh();}this._oMasterController.adaptToDetailSelection();if(this._oDetailController){this._oDetailController.productChanged();}this._executeNavigation(this._mRoutes.DETAIL,{productID:encodeURIComponent(p)},!D.system.phone);},navToMaster:function(p){this._executeNavigation(this._mRoutes.MASTER,{},true);this._oApplicationProperties.setProperty("/preferredIds",p?[p]:[]);this._oApplicationProperties.setProperty("/productId",null);this._changeEditMode(false);this._oMasterController.findItem();},navToProductEditPage:function(d){if(d){this._oApplicationProperties.setProperty("/productId",d);}else{d=this._oApplicationProperties.getProperty("/productId");}this._changeEditMode(true);this._executeNavigation(this._mRoutes.DETAIL,{productID:encodeURIComponent(d)},!D.system.phone);this._oMasterController.adaptToDetailSelection();},_changeEditMode:function(i){if(this._oApplicationProperties.getProperty("/noEditMode")!==i){return;}this._oApplicationProperties.setProperty("/noEditMode",!i);if(this._oDetailController){this._oDetailController.editModeChanged();}},navToEmptyPage:function(t,r){this._oApplicationProperties.setProperty("/emptyText",t);if(r){this._executeNavigation(this._mRoutes.MASTER);}this._oRouter.getTargets().display("empty");},navBack:function(f,d){if(this._oApplicationProperties.getProperty("/noEditMode")){this._navBackImpl(f);}else{var p=d.getPathForDraftId(this._oApplicationProperties.getProperty("/productId"));d.deleteProductDraft(p,this._navBackImpl.bind(this,f));}},_navBackImpl:function(f){var h=H.getInstance(),p=h.getPreviousHash();this._changeEditMode(false);if(typeof p!=="undefined"){history.go(-1);}else if(f){this.navToMaster();}else{var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");if(c){c.toExternal({target:{shellHash:"#"}});}}},_executeNavigation:function(n,p,r){this._bSubControllersMustBeAdapted=!this._oDetailController;this._oRouter.navTo(n,p,r);}});});
