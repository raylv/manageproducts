/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/UploadCollectionParameter","nw/epm/refapps/ext/prod/manage/model/formatter","nw/epm/refapps/ext/prod/manage/controller/messages"],function(C,U,f,m){"use strict";function M(t){sap.ui.require(["sap/m/MessageBox","nw/epm/refapps/ext/prod/manage/controller/utilities"],function(a,u){a.alert(t,{styleClass:u.getContentDensityClass()});});}return C.extend("nw.epm.refapps.ext.prod.manage.controller.ProductDraftUploadImages",{formatter:f,onInit:function(){this._oControlUploadImage=this.byId("Upload_Images");},onFileTypeMismatch:function(e){var o=e.getParameters().getParameter("fileType");M(this._oResourceBundle.getText("ymsg.fileTypeMismatch",o));},onUploadCompleted:function(e){var r=e.getParameters();if(r.getParameter("status")===201){this._fnSetDraftDirty();}else{var E=r.getParameter("responseRaw");m.showXMLErrorMessage(E,this.getView());}this._oControlUploadImage.getBinding("items").refresh();},onImageDelete:function(e){var i=e.getParameters().documentId;var p=this.getView().getModel().createKey("/ImageDrafts",{Id:i});this._oDataHelper.deleteImageDraft(p,function(){this._fnSetDraftDirty();this._oControlUploadImage.getBinding("items").refresh();}.bind(this));},onChange:function(){var s=function(){var c=this.getView().getModel().getSecurityToken(),F=false,h=this._oControlUploadImage.getHeaderParameters();if(h){for(var i=0;i<h.length;i++){if(h[i].getName()==="x-csrf-token"){F=true;h[i].setValue(c);break;}}}if(!F){this._oControlUploadImage.addHeaderParameter(new U({name:"x-csrf-token",value:c}));}}.bind(this);this._whenSecurityToken(s);},setInitData:function(s){this._oDataHelper=s.oDataHelper;this._fnSetDraftDirty=s.fnDirty;this._oResourceBundle=s.oResourceBundle;},_whenSecurityToken:function(w){this.getView().getModel().refreshSecurityToken(w,function(){M(this._oResourceBundle.getText("ymsg.securityTokenNotRetrieved"));}.bind(this));}});});
